# Turborepo Starter Kit

[![Powered by Turborepo](https://img.shields.io/badge/powered_by-Turborepo-blue?style=for-the-badge&logo=turborepo)](https://turbo.build/)
[![Managed with pnpm](https://img.shields.io/badge/managed_with-pnpm-yellow?style=for-the-badge&logo=pnpm)](https://pnpm.io/)
[![License: MIT](https://img.shields.io/badge/License-MIT-green.svg?style=for-the-badge)](https://opensource.org/licenses/MIT)

è¿™æ˜¯ä¸€ä¸ªåŸºäº **pnpm** å’Œ **Turborepo** çš„é«˜æ€§èƒ½ Monorepo é¡¹ç›®å…¥é—¨å¥—ä»¶ã€‚å®ƒä¸ºä½ é¢„è®¾äº†ç°ä»£åŒ–çš„å‰ç«¯å¼€å‘ç¯å¢ƒï¼Œæ—¨åœ¨æä¾›æœ€ä½³çš„å¼€å‘ä½“éªŒå’Œå¯æ‰©å±•æ€§ã€‚

## âœ¨ ç‰¹æ€§

- **ğŸš€ é«˜æ€§èƒ½ Monorepo**: ä½¿ç”¨ [Turborepo](https://turbo.build/) å®ç°æé€Ÿçš„æ„å»ºã€æµ‹è¯•å’Œä»£ç æ£€æŸ¥ã€‚
- **ğŸ“¦ é«˜æ•ˆåŒ…ç®¡ç†**: ä½¿ç”¨ [pnpm](https://pnpm.io/) ç®¡ç†ä¾èµ–ï¼ŒèŠ‚çœç£ç›˜ç©ºé—´å¹¶é¿å…å¹½çµä¾èµ–ã€‚
- **ğŸ”§ å¯æ‰©å±•çš„åº”ç”¨å’ŒåŒ…**: åœ¨ `apps` å’Œ `packages` ç›®å½•ä¸­è½»æ¾æ·»åŠ æ–°çš„åº”ç”¨æˆ–å…±äº«åº“ã€‚
- **ğŸŒ ç¯å¢ƒé…ç½®åˆ†ç¦»**: é€šè¿‡ `.env` æ–‡ä»¶é›†ä¸­ç®¡ç†ä¸åŒç¯å¢ƒï¼ˆå¼€å‘ã€ç”Ÿäº§ï¼‰çš„é…ç½®ã€‚
- **ğŸ¨ å…±äº« UI å’Œé€»è¾‘**: å†…ç½® `@trs/ui` (å…±äº«ç»„ä»¶) å’Œ `@trs/utils` (å…±äº«å·¥å…·å‡½æ•°) ç­‰åŒ…ï¼Œä¿ƒè¿›ä»£ç å¤ç”¨ã€‚
- **ğŸ’… ç»Ÿä¸€ä»£ç é£æ ¼**: é€šè¿‡å…±äº«çš„ `@trs/lint` åŒ…æä¾›ä¸€è‡´çš„ ESLint é…ç½®ï¼Œç¡®ä¿æ•´ä¸ªé¡¹ç›®çš„ä»£ç è´¨é‡ã€‚
- **âš¡ï¸ ç°ä»£å‰ç«¯æ¡†æ¶**: åº”ç”¨é»˜è®¤ä½¿ç”¨ [Vue 3](https://vuejs.org/) å’Œ [Vite](https://vitejs.dev/)ï¼Œæä¾›æè‡´çš„å¼€å‘é€Ÿåº¦ã€‚

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ APP1/         # ç¬¬ä¸€ä¸ª Vue åº”ç”¨
â”‚   â””â”€â”€ APP2/         # ç¬¬äºŒä¸ª Vue åº”ç”¨
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ config/       # å…±äº«é…ç½®
â”‚   â”œâ”€â”€ fetch/        # å…±äº«æ•°æ®è¯·æ±‚æ¨¡å—
â”‚   â”œâ”€â”€ lint/         # å…±äº« ESLint é…ç½®
â”‚   â”œâ”€â”€ ui/           # å…±äº« Vue ç»„ä»¶åº“
â”‚   â””â”€â”€ utils/        # å…±äº«å·¥å…·å‡½æ•°
â”œâ”€â”€ .env.development  # å¼€å‘ç¯å¢ƒå˜é‡
â”œâ”€â”€ .env.production   # ç”Ÿäº§ç¯å¢ƒå˜é‡
â”œâ”€â”€ package.json      # æ ¹ package.json
â”œâ”€â”€ pnpm-workspace.yaml
â””â”€â”€ turbo.json
```

- **`apps`**: å­˜æ”¾å„ä¸ªç‹¬ç«‹çš„åº”ç”¨ï¼ˆä¾‹å¦‚ç½‘ç«™ã€åå°ç®¡ç†ç³»ç»Ÿç­‰ï¼‰ã€‚
- **`packages`**: å­˜æ”¾å¯è¢«å¤šä¸ª `apps` å…±äº«çš„ä»£ç åº“ï¼ˆä¾‹å¦‚å…¬å…±ç»„ä»¶ã€å·¥å…·å‡½æ•°ã€é…ç½®ç­‰ï¼‰ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

**1. å…‹éš†é¡¹ç›®**

```bash
git clone <your-repo-url>
cd <your-repo-name>
```

**2. å®‰è£…ä¾èµ–**

åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œï¼š

```bash
pnpm install
```

**3. åˆå§‹åŒ– Git Hooks**

ä¸ºäº†ç¡®ä¿ä»£ç æäº¤æ—¶è‡ªåŠ¨æ‰§è¡Œä»£ç é£æ ¼æ£€æŸ¥ï¼Œä½ éœ€è¦åˆå§‹åŒ– `simple-git-hooks`ã€‚è¿™åªéœ€è¦åœ¨ç¬¬ä¸€æ¬¡è®¾ç½®é¡¹ç›®æ—¶æ‰§è¡Œä¸€æ¬¡ã€‚

```bash
pnpm sgh
```

**4. å¯åŠ¨å¼€å‘æœåŠ¡**

æ­¤å‘½ä»¤ä¼šåŒæ—¶å¯åŠ¨æ‰€æœ‰ `apps` ä¸‹çš„åº”ç”¨ï¼š

```bash
pnpm dev
```

ç„¶åä½ å°±å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è®¿é—®å¯¹åº”çš„åº”ç”¨äº†ï¼ˆé€šå¸¸æ˜¯ `http://localhost:5173` å’Œ `http://localhost:5174`ï¼‰ã€‚

## ğŸ› ï¸ å¸¸ç”¨å‘½ä»¤

æ‰€æœ‰å‘½ä»¤éƒ½å»ºè®®åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œã€‚

- `pnpm dev`: å¯åŠ¨æ‰€æœ‰åº”ç”¨çš„å¼€å‘æ¨¡å¼ã€‚
- `pnpm build`: æ„å»ºæ‰€æœ‰åº”ç”¨å’ŒåŒ…ã€‚
- `pnpm lint`: å¯¹æ•´ä¸ªé¡¹ç›®è¿›è¡Œä»£ç é£æ ¼æ£€æŸ¥å¹¶è‡ªåŠ¨ä¿®å¤ã€‚

### æ–°å¢é¡¹ç›®

å½“ä½ åœ¨ `apps` ç›®å½•ä¸‹æ·»åŠ ä¸€ä¸ªæ–°çš„å­é¡¹ç›®æ—¶ï¼ˆä¾‹å¦‚ `APP3`ï¼‰ï¼Œè¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ä»¥ç¡®ä¿å…¶æ­£ç¡®é›†æˆåˆ° Turborepo å·¥ä½œæµä¸­ï¼š

**1. é…ç½® `vite.config.js`**

ä¸ºäº†è®©æ–°çš„å­é¡¹ç›®èƒ½å¤Ÿæ­£ç¡®åŠ è½½æ ¹ç›®å½•ä¸‹çš„ `.env` æ–‡ä»¶ï¼Œä½ éœ€è¦åœ¨å…¶ `vite.config.js` ä¸­è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š

```javascript
import { defineConfig } from 'vite';
import vue from '@vitejs/plugin-vue';
import path from 'path';

export default defineConfig({
  plugins: [vue()],
  // å…³é”®é…ç½®ï¼šå°† envDir æŒ‡å‘æ ¹ç›®å½•
  envDir: path.resolve(__dirname, '../../'),
});
```

**2. é…ç½® `package.json`**

åœ¨æ–°é¡¹ç›®çš„ `package.json` ä¸­ï¼Œä½ éœ€è¦è®¾ç½®ä»¥ä¸‹å…³é”®å­—æ®µï¼š

- **`scripts`**: æ·»åŠ æ„å»ºã€éƒ¨ç½²å’Œä»£ç æ£€æŸ¥è„šæœ¬ã€‚`APP_NAME` éœ€è¦æ›¿æ¢ä¸ºä½ çš„åº”ç”¨åï¼ˆä¾‹å¦‚ `APP3`ï¼‰ã€‚
- **`dependencies`**: æ·»åŠ å¯¹å…±äº«åŒ…ï¼ˆå¦‚ `@trs/ui`ï¼‰çš„å¼•ç”¨ã€‚
- **`devDependencies`**: æ·»åŠ  `eslint` ä»¥æ”¯æŒä»£ç æ£€æŸ¥ã€‚

```json
{
  "name": "your-app-name",
  "version": "1.0.0",
  "private": true,
  "scripts": {
    "dev": "vite",
    "build:dev": "vite build --mode development",
    "build:prod": "vite build",
    "preview": "vite preview",
    "deploy:dev": "pnpm build:dev && bash ../../scripts/deploy.sh APP_NAME dev",
    "deploy:prod": "pnpm build:prod && bash ../../scripts/deploy.sh APP_NAME prod",
    "lint": "eslint"
  },
  "dependencies": {
    "vue": "^3.5.18",
    "@trs/ui": "workspace:*",
    "@trs/config": "workspace:*",
    "@trs/utils": "workspace:*",
    "@trs/lint": "workspace:*"
  },
  "devDependencies": {
    "eslint": "latest",
    "vite": "latest",
    "@vitejs/plugin-vue": "latest"
  }
}
```

**3. æŒ‰éœ€æ·»åŠ ä¾èµ–**

æ ¹æ®ä½ çš„é¡¹ç›®éœ€æ±‚ï¼Œå¯èƒ½éœ€è¦æ·»åŠ å…¶ä»–å…±äº«åŒ…ä½œä¸ºä¾èµ–ï¼Œä¾‹å¦‚ï¼š

- `@trs/fetch`: å¦‚æœéœ€è¦ä½¿ç”¨å…±äº«çš„æ•°æ®è¯·æ±‚æ¨¡å—ã€‚

åªéœ€åœ¨ `dependencies` ä¸­æ·»åŠ  `"@trs/fetch": "workspace:*"` å³å¯ã€‚

å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œè®°å¾—åœ¨æ ¹ç›®å½•é‡æ–°æ‰§è¡Œ `pnpm install`ï¼Œä»¥ç¡®ä¿æ‰€æœ‰ä¾èµ–å…³ç³»éƒ½å·²æ­£ç¡®é“¾æ¥ã€‚



eslint æ”¾å¼ƒå…¨å±€å•ä¸€eslint.config.mjs
è€Œæ˜¯å°è£…ä¸ºä¸€ä¸ªä¾èµ–åŒ… è§„å®šé€šç”¨çš„eslinté…ç½® ä¸åŒé¡¹ç›®å¯ä»¥æ ¹æ®éœ€è¦å¾®è°ƒ,å¦‚æ·»åŠ æ–°ruleæˆ–è€…è¦†ç›–åŸæŸæ¡rule

ä½¿ç”¨æ³¨æ„:éœ€è¦é¡¹ç›®è‡ªèº«å®‰è£…`eslint`ä¾èµ–ä»¥åŠé…ç½®lintè„šæœ¬,å¹¶ä¸”ç‰ˆæœ¬æ¨èå’Œ`@trs/lint`ä¾èµ–ç‰ˆæœ¬ä¸€è‡´

```json
pnpm i -D eslint

"scripts": {
  "lint": "eslint"
}
```


## é«˜çº§ç”¨æ³•ï¼šå¢é‡ä»»åŠ¡æ‰§è¡Œ

Turborepo çš„æ ¸å¿ƒä¼˜åŠ¿ä¹‹ä¸€æ˜¯èƒ½å¤Ÿåªåœ¨å—å˜æ›´å½±å“çš„é¡¹ç›®ä¸Šæ‰§è¡Œä»»åŠ¡ï¼Œä»è€Œæå¤§æå‡æ•ˆç‡ã€‚è¿™ç§â€œå¢é‡æ‰§è¡Œâ€çš„æœºåˆ¶åœ¨ä¸åŒåœºæ™¯ä¸‹æœ‰ä¸åŒçš„å®ç°æ–¹å¼ã€‚

### åœºæ™¯ä¸€ï¼šCI/CD ä¸­çš„å¢é‡éƒ¨ç½² (ä¾‹å¦‚ `deploy`)

åœ¨ CI/CD ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬é€šå¸¸å¸Œæœ›åªéƒ¨ç½²é‚£äº›è‡ªä¸Šæ¬¡æˆåŠŸéƒ¨ç½²ä»¥æ¥å‘ç”Ÿå˜åŒ–çš„åº”ç”¨ã€‚ç›´æ¥è¿è¡Œ `turbo run deploy` ä¼šå°è¯•åœ¨æ‰€æœ‰é¡¹ç›®ä¸­æ‰§è¡Œï¼Œè¿™å¹¶éæˆ‘ä»¬æ‰€æƒ³ã€‚

æ­£ç¡®çš„åšæ³•æ˜¯ä½¿ç”¨ `turbo` çš„ `--filter` æ ‡å¿—ï¼Œå¹¶ç»“åˆ Git çš„æäº¤å†å²æ¥ç¡®å®šèŒƒå›´ã€‚

**å·¥ä½œåŸç†**ï¼šæˆ‘ä»¬é€šè¿‡ `--filter` æ˜ç¡®å‘Šè¯‰ `turbo` éœ€è¦æ¯”è¾ƒçš„ Git è®°å½•èŒƒå›´ã€‚`turbo` ä¼šåˆ†æè¿™ä¸ªèŒƒå›´å†…çš„æ–‡ä»¶å˜æ›´ï¼Œæ‰¾å‡ºæ‰€æœ‰å—å½±å“çš„å·¥ä½œç©ºé—´ï¼ˆåŒ…æ‹¬ç›´æ¥ä¿®æ”¹å’Œé—´æ¥ä¾èµ–ï¼‰ï¼Œç„¶ååªåœ¨è¿™äº›å·¥ä½œç©ºé—´ä¸Šæ‰§è¡ŒæŒ‡å®šçš„ä»»åŠ¡ï¼ˆå¦‚ `deploy`ï¼‰ã€‚

**å¸¸ç”¨å‘½ä»¤**ï¼š

åœ¨ CI/CD æµç¨‹ä¸­ï¼Œé€šå¸¸åœ¨ä»£ç åˆå¹¶åˆ°ä¸»åˆ†æ”¯åè§¦å‘ï¼Œæ­¤æ—¶ `HEAD` æŒ‡å‘æœ€æ–°çš„ commitã€‚

- **ä¸ä¸Šä¸€ä¸ª commit æ¯”è¾ƒï¼ˆæ¨èï¼‰**:
  ```bash
  # è¿™ä¼šéƒ¨ç½²æœ¬æ¬¡åˆå¹¶æ‰€å¼•å…¥çš„å˜æ›´
  turbo run deploy --filter="...[HEAD~1]"
  ```
- **ä½¿ç”¨ CI/CD å¹³å°çš„ç¯å¢ƒå˜é‡ï¼ˆæ›´ç²¾ç¡®ï¼‰**:
  å¤§å¤šæ•°å¹³å°ä¼šæä¾›å˜æ›´å‰åçš„ commit SHAï¼Œè¿™æ˜¯æœ€å¥å£®çš„æ–¹å¼ã€‚
  ```bash
  # GitHub Actions ç¤ºä¾‹
  turbo run deploy --filter="...[$CI_COMMIT_BEFORE_SHA]"
  ```

### åœºæ™¯äºŒï¼šæœ¬åœ°æäº¤æ—¶çš„å¢é‡æ£€æŸ¥ (ä¾‹å¦‚ `lint`)

åœ¨æœ¬åœ°å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨ `git commit` æ—¶ä»…å¯¹æœ¬æ¬¡æäº¤ä¸­æš‚å­˜ï¼ˆstagedï¼‰çš„æ–‡ä»¶è¿›è¡Œä»£ç æ£€æŸ¥ã€‚è¿™ä¸ªè¿‡ç¨‹ç”± `simple-git-hooks` å’Œ `lint-staged` ååŒå®Œæˆã€‚

**å‰ææ¡ä»¶**ï¼šä¸ºäº†ä½¿è¯¥åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼Œè¯·ç¡®ä¿æ ¹ç›®å½•çš„ `package.json` ä¸­å·²å®‰è£… `lint-staged` å’Œ `simple-git-hooks` ä½œä¸ºå¼€å‘ä¾èµ–ã€‚å¦‚æœç¼ºå¤±ï¼Œè¯·æ‰§è¡Œ `pnpm add -D -w lint-staged simple-git-hooks` è¿›è¡Œå®‰è£…ã€‚

**å·¥ä½œåŸç†**ï¼š

1.  **`simple-git-hooks` è§¦å‘**: å½“æ‚¨æ‰§è¡Œ `git commit` æ—¶ï¼Œ`simple-git-hooks` ä¼šæ ¹æ®é…ç½®ï¼ˆ`"pre-commit": "pnpm staged"`ï¼‰æ‰§è¡Œ `pnpm staged` å‘½ä»¤ã€‚
2.  **`lint-staged` æ•è·æ–‡ä»¶**: `lint-staged` å¯åŠ¨åï¼Œä¼šè·å–æ‰€æœ‰æš‚å­˜åŒºå†…çš„æ–‡ä»¶ã€‚
3.  **`lint-staged` è°ƒç”¨ `turbo`**: å®ƒå°†åŒ¹é…åˆ°çš„**å…·ä½“æ–‡ä»¶å**ä½œä¸ºå‚æ•°ï¼Œä¼ é€’ç»™ `turbo` å‘½ä»¤ã€‚
4.  **`turbo` åˆ†å‘ä»»åŠ¡**: `turbo` æ¥æ”¶åˆ°å‘½ä»¤åï¼Œä¼šæ™ºèƒ½åœ°åˆ†ææ¯ä¸ªæ–‡ä»¶å±äºå“ªä¸ªå·¥ä½œç©ºé—´ã€‚
5.  **`eslint` ç²¾å‡†æ‰§è¡Œ**: `turbo` ä¼šåœ¨å¯¹åº”çš„å·¥ä½œç©ºé—´å†…æ‰§è¡Œ `lint` è„šæœ¬ï¼ˆä¾‹å¦‚ `"lint": "eslint"`ï¼‰ï¼Œå¹¶å°†æ–‡ä»¶å’Œä»é¡¶å±‚ä¼ æ¥çš„ `--fix` å‚æ•°ä¸€å¹¶äº¤ç»™ `eslint`ã€‚


**é‡è¦é…ç½®ï¼š`lint-staged`ã€`turbo` ä¸ `eslint` çš„ååŒ**

ä¸ºäº†è®© `lint-staged` åœ¨æäº¤æ—¶æ­£ç¡®åœ°å¯¹æš‚å­˜æ–‡ä»¶è¿›è¡Œæ£€æŸ¥ï¼Œéœ€è¦ç¡®ä¿æ ¹ç›®å½•å’Œå­é¡¹ç›®çš„ `package.json` é…ç½®æ­£ç¡®ååŒã€‚

1.  **å­é¡¹ç›®é…ç½® (`apps/APP1/package.json`)**
    å­é¡¹ç›®çš„ `lint` è„šæœ¬åº”è¯¥éå¸¸çº¯ç²¹ï¼Œåªä¿ç•™ `eslint` å‘½ä»¤æœ¬èº«ï¼Œä»¥ä¾¿æ¥æ”¶æ¥è‡ª `lint-staged` ä¼ é€’çš„æ–‡ä»¶åˆ—è¡¨ã€‚
    ```json
    "scripts": {
      "lint": "eslint"
    }
    ```

2.  **æ ¹é¡¹ç›®é…ç½® (`package.json`)**
    æ ¹ç›®å½•çš„ `lint-staged` é…ç½®è´Ÿè´£è°ƒç”¨ `turbo`ï¼Œå¹¶ä½¿ç”¨ `--` åˆ†éš”ç¬¦å°† `lint-staged` æ•è·çš„æ–‡ä»¶åˆ—è¡¨ä½œä¸ºå‚æ•°ä¼ é€’ä¸‹å»ã€‚
    ```json
    "lint-staged": {
      "*.{js,jsx,ts,tsx,vue}": "turbo run lint --"
    }
    ```

åŒæ—¶ï¼Œä¸ºäº†å®ç°è‡ªåŠ¨ä¿®å¤ï¼Œæ ¹ç›®å½•çš„ `lint` è„šæœ¬åº”é…ç½®ä¸ºï¼š
```json
"scripts": {
  "lint": "turbo run lint -- --fix"
}
```
è¿™é‡Œçš„ç¬¬ä¸€ä¸ª `--` æ˜¯ `turbo` ç”¨æ¥å°† `--fix` å‚æ•°ä¼ é€’ç»™å­é¡¹ç›®çš„ `lint` è„šæœ¬ã€‚

**ç»“è®º**ï¼š
- å¯¹äº `deploy` è¿™ç±»ç”±å¼€å‘è€…æˆ– CI ä¸»åŠ¨å‘èµ·çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬ä½¿ç”¨ `--filter` æ¥**å‘ŠçŸ¥ `turbo` å˜æ›´çš„èŒƒå›´**ï¼ˆä¾‹å¦‚ `...[HEAD~1]`ï¼‰ã€‚
- å¯¹äº `lint` è¿™ç±»ç”± `lint-staged` è§¦å‘çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬ä¾èµ– `lint-staged` **æ”¶é›†æ–‡ä»¶åˆ—è¡¨**ï¼Œå¹¶é€šè¿‡ `turbo run lint --` çš„æ–¹å¼ï¼Œå°†è¿™äº›æ–‡ä»¶ä½œä¸º**å‚æ•°**ä¼ é€’ç»™å¯¹åº”å·¥ä½œç©ºé—´å†…çš„ `eslint` è¿›ç¨‹ã€‚
