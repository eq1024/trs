# Turborepo Starter Kit

[![Powered by Turborepo](https://img.shields.io/badge/powered_by-Turborepo-blue?style=for-the-badge&logo=turborepo)](https://turbo.build/)
[![Managed with pnpm](https://img.shields.io/badge/managed_with-pnpm-yellow?style=for-the-badge&logo=pnpm)](https://pnpm.io/)
[![License: MIT](https://img.shields.io/badge/License-MIT-green.svg?style=for-the-badge)](https://opensource.org/licenses/MIT)

è¿™æ˜¯ä¸€ä¸ªåŸºäº **pnpm** å’Œ **Turborepo** çš„é«˜æ€§èƒ½ Monorepo é¡¹ç›®å…¥é—¨å¥—ä»¶ã€‚å®ƒä¸ºä½ é¢„è®¾äº†ç°ä»£åŒ–çš„å‰ç«¯å¼€å‘ç¯å¢ƒï¼Œæ—¨åœ¨æä¾›æœ€ä½³çš„å¼€å‘ä½“éªŒå’Œå¯æ‰©å±•æ€§ã€‚

## âœ¨ ç‰¹æ€§

- **ğŸš€ é«˜æ€§èƒ½ Monorepo**: ä½¿ç”¨ [Turborepo](https://turbo.build/) å®ç°æé€Ÿçš„æ„å»ºã€æµ‹è¯•å’Œä»£ç æ£€æŸ¥ã€‚
- **ğŸ“¦ é«˜æ•ˆåŒ…ç®¡ç†**: ä½¿ç”¨ [pnpm](https://pnpm.io/) ç®¡ç†ä¾èµ–ï¼ŒèŠ‚çœç£ç›˜ç©ºé—´å¹¶é¿å…å¹½çµä¾èµ–ã€‚
- **ğŸ”§ å¯æ‰©å±•çš„åº”ç”¨å’ŒåŒ…**: åœ¨ `apps` å’Œ `packages` ç›®å½•ä¸­è½»æ¾æ·»åŠ æ–°çš„åº”ç”¨æˆ–å…±äº«åº“ã€‚
- **ğŸŒ ç¯å¢ƒé…ç½®åˆ†ç¦»**: é€šè¿‡ `.env` æ–‡ä»¶é›†ä¸­ç®¡ç†ä¸åŒç¯å¢ƒï¼ˆå¼€å‘ã€ç”Ÿäº§ï¼‰çš„é…ç½®ã€‚
- **ğŸ›¡ï¸ å°è£…çš„æƒé™æ§åˆ¶**: å†…ç½® `@trs/permission` åŒ…ï¼Œæä¾› `v-permission` æŒ‡ä»¤ï¼Œå¯è½»æ¾å®ç°å‰ç«¯å…ƒç´ çš„æƒé™æ§åˆ¶ã€‚
- **ğŸ“¡ ç»Ÿä¸€çš„æ•°æ®è¯·æ±‚**: å†…ç½® `@trs/fetch` åŒ…ï¼ŒåŸºäº `axios` æä¾›äº†ç»Ÿä¸€çš„è¯·æ±‚ã€å“åº”å’Œé”™è¯¯å¤„ç†ï¼Œå¹¶é›†æˆäº†æµè§ˆå™¨æŒ‡çº¹åŠŸèƒ½ã€‚
- **ğŸ¨ å¼ºç±»å‹çš„å…±äº«åº“**: æ ¸å¿ƒå…±äº«åº“ `@trs/ui` å’Œ `@trs/utils` å·²å®Œå…¨ä½¿ç”¨ TypeScript æ„å»ºï¼Œæä¾›æ›´å¥½çš„ä»£ç æç¤ºå’Œç±»å‹å®‰å…¨ã€‚
- **ğŸ’… ç»Ÿä¸€ä»£ç é£æ ¼**: é€šè¿‡å…±äº«çš„ `@trs/lint` åŒ…æä¾›ä¸€è‡´çš„ ESLint é…ç½®ã€‚
- **âœ… è‡ªåŠ¨åŒ–ä»£ç æ£€æŸ¥**: é›†æˆ `lint-staged` å’Œ `simple-git-hooks`ï¼Œåœ¨ `git commit` æ—¶è‡ªåŠ¨å¯¹æš‚å­˜æ–‡ä»¶è¿›è¡Œä»£ç é£æ ¼æ£€æŸ¥å’Œä¿®å¤ï¼Œä»æºå¤´ä¿è¯ä»£ç è´¨é‡ã€‚
- **âš¡ï¸ ç°ä»£å‰ç«¯æ¡†æ¶**: åº”ç”¨é»˜è®¤ä½¿ç”¨ [Vue 3](https://vuejs.org/) å’Œ [Vite](https://vitejs.dev/)ï¼Œæä¾›æè‡´çš„å¼€å‘é€Ÿåº¦ã€‚

##  é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ APP1/         # ç¬¬ä¸€ä¸ª Vue åº”ç”¨
â”‚   â””â”€â”€ APP2/         # ç¬¬äºŒä¸ª Vue åº”ç”¨
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ config/       # å…±äº«é…ç½® (JavaScript)
â”‚   â”œâ”€â”€ fetch/        # å…±äº«æ•°æ®è¯·æ±‚æ¨¡å— (TypeScript)
â”‚   â”œâ”€â”€ lint/         # å…±äº« ESLint é…ç½® (JavaScript)
â”‚   â”œâ”€â”€ permission/   # å…±äº«æƒé™æ§åˆ¶æ¨¡å— (TypeScript)
â”‚   â”œâ”€â”€ ui/           # å…±äº« Vue ç»„ä»¶åº“ (TypeScript)
â”‚   â””â”€â”€ utils/        # å…±äº«å·¥å…·å‡½æ•° (TypeScript)
â”œâ”€â”€ .env.development  # å¼€å‘ç¯å¢ƒå˜é‡
â”œâ”€â”€ .env.production   # ç”Ÿäº§ç¯å¢ƒå˜é‡
â”œâ”€â”€ package.json      # æ ¹ package.json
â”œâ”€â”€ pnpm-workspace.yaml
â””â”€â”€ turbo.json
```

- **`apps`**: å­˜æ”¾å„ä¸ªç‹¬ç«‹çš„åº”ç”¨ï¼ˆä¾‹å¦‚ç½‘ç«™ã€åå°ç®¡ç†ç³»ç»Ÿç­‰ï¼‰ã€‚
- **`packages`**: å­˜æ”¾å¯è¢«å¤šä¸ª `apps` å…±äº«çš„ä»£ç åº“ï¼ˆä¾‹å¦‚å…¬å…±ç»„ä»¶ã€å·¥å…·å‡½æ•°ã€é…ç½®ç­‰ï¼‰ã€‚

## ğŸ’¡ æ ¸å¿ƒè®¾è®¡ä¸å®è·µ

æœ¬æ¨¡æ¿åŒ…å«äº†ä¸€äº›æ—¨åœ¨æå‡å¼€å‘æ•ˆç‡å’Œå¯ç»´æŠ¤æ€§çš„æ ¸å¿ƒè®¾è®¡ï¼Œç†è§£å®ƒä»¬æœ‰åŠ©äºä½ æ›´å¥½åœ°ä½¿ç”¨å’Œæ‰©å±•æ­¤é¡¹ç›®ã€‚

### 1. ç¯å¢ƒå˜é‡ç®¡ç†

- **é›†ä¸­ç®¡ç†**: æ‰€æœ‰çš„ç¯å¢ƒå˜é‡ï¼ˆå¦‚ `VITE_API_URL`ï¼‰éƒ½å®šä¹‰åœ¨é¡¹ç›®**æ ¹ç›®å½•**çš„ `.env.development` å’Œ `.env.production` æ–‡ä»¶ä¸­ã€‚
- **è‡ªåŠ¨åŠ è½½**: æ¯ä¸ª `app` ä¸­çš„ `vite.config.js` éƒ½é€šè¿‡ `envDir: path.resolve(__dirname, '../../')` é…ç½®æŒ‡å‘äº†æ ¹ç›®å½•ã€‚è¿™ä½¿å¾— Vite åœ¨å¯åŠ¨æ—¶èƒ½è‡ªåŠ¨åŠ è½½æ ¹ç›®å½•çš„ `.env` æ–‡ä»¶ï¼Œå®ç°äº†ç¯å¢ƒå˜é‡çš„å…¨å±€å…±äº«ï¼Œé¿å…äº†åœ¨æ¯ä¸ªåº”ç”¨ä¸­é‡å¤é…ç½®ã€‚

### 2. ä»»åŠ¡ä¾èµ–ä¸ç¼“å­˜ (`turbo.json`)

Turborepo çš„æ ¸å¿ƒæ˜¯ `turbo.json` ä¸­çš„ `tasks` é…ç½®ã€‚

```json
"tasks": {
  "build": {
    "dependsOn": ["^build"],
    "outputs": ["dist/**"]
  },
  "lint": {},
  // ...
}
```

- **`dependsOn: ["^build"]`**: `^` ç¬¦å·æ˜¯å…³é”®ã€‚å®ƒå‘Šè¯‰ Turborepoï¼Œåœ¨æ‰§è¡ŒæŸä¸ªåŒ…çš„ `build` ä»»åŠ¡ä¹‹å‰ï¼Œå¿…é¡»å…ˆå®Œæˆå…¶æ‰€æœ‰**å†…éƒ¨ä¾èµ–é¡¹**ï¼ˆ`dependencies` å’Œ `devDependencies`ï¼‰çš„ `build` ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œ`app1` ä¾èµ– `@trs/ui`ï¼Œé‚£ä¹ˆåœ¨æ„å»º `app1` ä¹‹å‰ï¼Œ`turbo` ä¼šç¡®ä¿ `@trs/ui` å·²ç»è¢«æˆåŠŸæ„å»ºã€‚
- **`outputs`**: è¿™ä¸ªå­—æ®µå‘Šè¯‰ `turbo` ä»»åŠ¡çš„äº§ç‰©å­˜æ”¾åœ¨å“ªé‡Œã€‚`turbo` ä¼šç¼“å­˜è¿™äº›äº§ç‰©ã€‚å¦‚æœä¸‹æ¬¡æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œç›¸å…³æ–‡ä»¶å’Œä¾èµ–æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œ`turbo` ä¼šç›´æ¥ä»ç¼“å­˜ä¸­æ¢å¤äº§ç‰©ï¼Œä»è€Œå®ç°ç§’çº§æ„å»ºã€‚

### 3. å·¥ä½œç©ºé—´ä¸å†…éƒ¨ä¾èµ–

- **`pnpm-workspace.yaml`**: æ­¤æ–‡ä»¶å®šä¹‰äº† pnpm å·¥ä½œç©ºé—´çš„èŒƒå›´ï¼Œå‘Šè¯‰ pnpm åœ¨ `apps` å’Œ `packages` ç›®å½•ä¸‹å¯»æ‰¾å­é¡¹ç›®ã€‚
- **`"workspace:*"` åè®®**: åœ¨ `package.json` ä¸­ï¼Œä½ ä¼šçœ‹åˆ°ç±»ä¼¼ `"@trs/ui": "workspace:*"` çš„ä¾èµ–ã€‚è¿™æ˜¯ä¸€ç§ pnpm çš„å†…éƒ¨åè®®ï¼Œå®ƒä¼šç¡®ä¿ `app1` æ€»æ˜¯å¼•ç”¨å·¥ä½œç©ºé—´å†…æœ€æ–°ç‰ˆæœ¬çš„ `@trs/ui`ï¼Œè€Œæ— éœ€å‘å¸ƒåˆ° npmã€‚è¿™ä½¿å¾—è·¨åŒ…è”è°ƒå’Œä»£ç å¤ç”¨å˜å¾—æå…¶ç®€å•ã€‚

### 4. æƒé™æ§åˆ¶ (`@trs/permission`)

ä¸ºäº†åœ¨å‰ç«¯å®ç°ç²¾ç»†åŒ–çš„å…ƒç´ çº§åˆ«æƒé™æ§åˆ¶ï¼Œé¡¹ç›®å†…ç½®äº† `@trs/permission` åŒ…ã€‚å®ƒæä¾›äº†ä¸€ä¸ªæ ¸å¿ƒçš„ Vue æŒ‡ä»¤ï¼š`v-permission`ã€‚

**æ ¸å¿ƒåŠŸèƒ½ï¼š**

-   **æŒ‡ä»¤å¼æ§åˆ¶**: åªéœ€åœ¨éœ€è¦æ§åˆ¶çš„ DOM å…ƒç´ ä¸Šæ·»åŠ  `v-permission` æŒ‡ä»¤ï¼Œå³å¯æ ¹æ®ç”¨æˆ·æƒé™åŠ¨æ€åœ°æ˜¾ç¤ºæˆ–éšè—è¯¥å…ƒç´ ã€‚
-   **ä¸çŠ¶æ€ç®¡ç†é›†æˆ**: æŒ‡ä»¤ä¸ Pinia çš„ `auth` store è‡ªåŠ¨é›†æˆï¼Œå®æ—¶è·å–å½“å‰ç”¨æˆ·çš„æƒé™åˆ—è¡¨ã€‚
-   **æ”¯æŒé€šé…ç¬¦**: æ”¯æŒ `*` é€šé…ç¬¦ï¼Œæ‹¥æœ‰è¯¥æƒé™çš„ç”¨æˆ·å°†æ— è§†æ‰€æœ‰é™åˆ¶ã€‚

**ä½¿ç”¨æ–¹æ³•ï¼š**

1.  **åœ¨ `main.js` ä¸­å®‰è£…æŒ‡ä»¤**:
    ç¡®ä¿ä½ çš„åº”ç”¨å…¥å£æ–‡ä»¶ï¼ˆå¦‚ `apps/APP1/src/main.js`ï¼‰å·²ç»å®‰è£…äº†è¯¥æŒ‡ä»¤ã€‚è¿™ä¸€æ­¥é€šå¸¸å·²ç»ä¸ºä½ é…ç½®å¥½äº†ã€‚
    ```javascript
    import { createApp } from 'vue';
    import { createPinia } from 'pinia';
    import { setupPermissionDirective } from '@trs/permission';
    import { useAuthStore } from './stores/auth';
    
    const app = createApp(App);
    app.use(createPinia());

    // å°† auth store çš„ getter å‡½æ•°ä¼ é€’ç»™æŒ‡ä»¤
    setupPermissionDirective(app, {
      getAuthStore: () => useAuthStore(),
    });

    app.mount('#app');
    ```

2.  **åœ¨ç»„ä»¶ä¸­ä½¿ç”¨æŒ‡ä»¤**:
    åœ¨ä½ çš„ Vue ç»„ä»¶ä¸­ï¼Œç›´æ¥åœ¨éœ€è¦æ§åˆ¶çš„å…ƒç´ ä¸Šä½¿ç”¨ `v-permission`ï¼Œå¹¶ä¼ å…¥æ‰€éœ€çš„æƒé™å­—ç¬¦ä¸²ã€‚
    ```html
    <template>
      <!-- è¿™ä¸ªæŒ‰é’®åªæœ‰åœ¨ç”¨æˆ·æ‹¥æœ‰ 'btn:user:create' æƒé™æ—¶æ‰ä¼šæ˜¾ç¤º -->
      <button v-permission="'btn:user:create'">
        Create User
      </button>

      <!-- è¿™ä¸ªåŒºåŸŸåªæœ‰åœ¨ç”¨æˆ·æ‹¥æœ‰ 'page:dashboard:view' æƒé™æ—¶æ‰ä¼šæ˜¾ç¤º -->
      <div v-permission="'page:dashboard:view'">
        Dashboard Content...
      </div>
    </template>
    ```

### 5. API å®¢æˆ·ç«¯è®¾è®¡æ¨¡å¼

ä¸ºäº†å®ç°æœ€å¤§ç¨‹åº¦çš„è§£è€¦å’Œå¯å¤ç”¨æ€§ï¼Œé¡¹ç›®é‡‡ç”¨äº†ä¸€ç§åŸºäºå·¥å‚å‡½æ•°å’Œä¾èµ–æ³¨å…¥çš„ API å®¢æˆ·ç«¯è®¾è®¡æ¨¡å¼ã€‚

**æ ¸å¿ƒç†å¿µ**:

*   **åˆ†ç¦»èŒè´£**:
    *   **åº”ç”¨å±‚ (`apps/*`)**: è´Ÿè´£åˆ›å»ºå’Œé…ç½® `httpClient` å®ä¾‹ï¼Œå› ä¸ºå®ƒçŸ¥é“å…·ä½“çš„ `baseURL`ã€`token` ç®¡ç†æ–¹å¼å’Œ UI åé¦ˆï¼ˆå¦‚ `showError`ï¼‰ã€‚
    *   **`@trs/fetch` åŒ…**: æä¾›çº¯ç²¹çš„ã€ä¸å…·ä½“é¡¹ç›®ä¸šåŠ¡æ— å…³çš„ API å‡½æ•°å®šä¹‰ã€‚å®ƒä¸åŒ…å«ä»»ä½• `axios` å®ä¾‹ã€‚
    *   **`@trs/ui` åŒ…**: UI ç»„ä»¶æ¥æ”¶ä¸€ä¸ªå·²ç»åˆ›å»ºå¥½çš„ `api` å®¢æˆ·ç«¯ä½œä¸º `prop`ï¼Œå¹¶ç›´æ¥è°ƒç”¨å…¶æ–¹æ³•ï¼Œæ— éœ€å…³å¿ƒè¯·æ±‚æ˜¯å¦‚ä½•è¢«å‘é€çš„ã€‚

**ä¸¤ä¸ªæ ¸å¿ƒå·¥å‚å‡½æ•°**:

1.  **`createHttpClient(options)`**:
    *   **è¾“å…¥**: `baseUrl` å’Œä¸€ä¸ªåŒ…å« `getToken`, `showError` ç­‰åº”ç”¨å±‚å…·ä½“å®ç°çš„ `handlers` å¯¹è±¡ã€‚
    *   **è¾“å‡º**: ä¸€ä¸ªé…ç½®äº†å®Œæ•´æ‹¦æˆªå™¨ï¼ˆToken æ³¨å…¥ã€å…¨å±€ Loadingã€ç»Ÿä¸€é”™è¯¯å¤„ç†ç­‰ï¼‰çš„ `axios` å®ä¾‹ã€‚

2.  **`createApi(httpClient)`**:
    *   **è¾“å…¥**: ä¸€ä¸ªç”± `createHttpClient` åˆ›å»ºçš„ `axios` å®ä¾‹ã€‚
    *   **è¾“å‡º**: ä¸€ä¸ªå®Œæ•´çš„ã€ç±»å‹å®‰å…¨çš„ API å®¢æˆ·ç«¯ã€‚è¯¥å®¢æˆ·ç«¯èšåˆäº†æ‰€æœ‰åœ¨ `packages/fetch/api/` ç›®å½•ä¸‹å®šä¹‰çš„ API æ¨¡å—ã€‚

**å·¥ä½œæµç¨‹ç¤ºä¾‹**:

1.  **å®šä¹‰ API (`packages/fetch/api/resource.js`)**:
    API æ¨¡å—å¯¼å‡ºä¸€ä¸ªæ¥æ”¶ `httpClient` çš„å·¥å‚å‡½æ•°ã€‚
    ```javascript
    // packages/fetch/api/resource.js
    export default function createResourceApi(httpClient) {
      return {
        getResourceList(page_code, params) {
          return httpClient({ url: `/resources/${page_code}`, ... });
        },
      };
    }
    ```

2.  **åˆ›å»ºå¹¶æ³¨å…¥ (`apps/admin/src/main.js` æˆ–ç»„ä»¶å†…)**:
    åœ¨åº”ç”¨å±‚ï¼Œåˆ›å»º `httpClient` å’Œ `api` å®¢æˆ·ç«¯ã€‚
    ```javascript
    // apps/admin/src/main.js (æˆ–ä»»ä½•åˆå§‹åŒ–çš„åœ°æ–¹)
    import { createHttpClient, createApi } from '@trs/fetch';
    import { getToken } from './stores/auth'; // åº”ç”¨å±‚çš„å…·ä½“å®ç°

    const httpClient = createHttpClient({
      baseUrl: import.meta.env.VITE_API_BASE_URL,
      handlers: { getToken }
    });

    const api = createApi(httpClient);

    // ç„¶åå¯ä»¥å°† `api` æ³¨å…¥åˆ°æ•´ä¸ªåº”ç”¨ä¸­
    // app.provide('api', api);
    ```

3.  **åœ¨ UI ç»„ä»¶ä¸­ä½¿ç”¨ (`packages/ui/src/ListPage.vue`)**:
    UI ç»„ä»¶é€šè¿‡ `props` æ¥æ”¶ `api` å®¢æˆ·ç«¯ã€‚
    ```vue
    <!-- packages/ui/src/ListPage.vue -->
    <script setup>
    const props = defineProps({
      api: { type: Object, required: true }
    });

    async function fetchData() {
      // ç›´æ¥è°ƒç”¨ï¼Œæ— éœ€å…³å¿ƒ httpClient çš„å®ç°ç»†èŠ‚
      const response = await props.api.getResourceList(...);
    }
    </script>
    ```

è¿™ç§æ¨¡å¼ç¡®ä¿äº†å…±äº«åŒ… (`fetch`, `ui`) çš„çº¯ç²¹æ€§å’Œé€šç”¨æ€§ï¼Œä½¿å¾—å®ƒä»¬å¯ä»¥è¢«ä»»ä½•é¡¹ç›®å¤ç”¨ï¼Œè€Œä¸é¡¹ç›®ç›¸å…³çš„é…ç½®å’Œå®ç°åˆ™å®Œå…¨ä¿ç•™åœ¨åº”ç”¨å±‚ã€‚

**æ ¸å¿ƒåŠŸèƒ½ï¼š**

-   **ç»Ÿä¸€å®ä¾‹åˆ›å»º**: é€šè¿‡ `createHttpClient` å‡½æ•°åˆ›å»ºä¸€ä¸ªæºå¸¦é€šç”¨æ‹¦æˆªå™¨çš„ `axios` å®ä¾‹ã€‚
-   **è¯·æ±‚æ‹¦æˆªå™¨**:
    -   è‡ªåŠ¨ä¸ºè¯·æ±‚å¤´æ³¨å…¥ `Authorization` (Bearer Token)ã€‚
    -   è‡ªåŠ¨ä¸º `GET` è¯·æ±‚æ·»åŠ æ—¶é—´æˆ³ä»¥é˜²æ­¢ç¼“å­˜ã€‚
    -   è‡ªåŠ¨æ³¨å…¥æµè§ˆå™¨æŒ‡çº¹ (`X-Browser-Fingerprint`)ï¼Œå¯ç”¨äºå®‰å…¨é£æ§ã€‚
-   **å“åº”æ‹¦æˆªå™¨**:
    -   è‡ªåŠ¨å¤„ç†åç«¯è¿”å›çš„ä¸šåŠ¡é”™è¯¯ç ï¼ˆå¦‚ `code !== 200`ï¼‰ã€‚
    -   è‡ªåŠ¨å¤„ç† `401` (Token å¤±æ•ˆ)ã€`403` (æ— æƒé™)ã€`500` (æœåŠ¡å™¨é”™è¯¯) ç­‰ HTTP çŠ¶æ€ç ã€‚
    -   æˆåŠŸæ—¶è‡ªåŠ¨æå–å“åº”ä½“ä¸­çš„ `data` éƒ¨åˆ†ï¼Œç®€åŒ–ä¸šåŠ¡ä»£ç ã€‚
-   **é€»è¾‘è§£è€¦**: é€šè¿‡ `handlers` å‚æ•°å°†å…·ä½“çš„å®ç°ï¼ˆå¦‚å¦‚ä½•è·å– Tokenã€å¦‚ä½•æ˜¾ç¤º Loadingï¼‰ä¸å°è£…æœ¬èº«è§£è€¦ï¼Œä½¿å¾—è¯¥åŒ…å¯ä»¥è¢«ä»»ä½•æ¡†æ¶ï¼ˆVue, Reactï¼‰æˆ–æ— æ¡†æ¶çš„ JS/TS é¡¹ç›®ä½¿ç”¨ã€‚

**ä½¿ç”¨æ–¹æ³•ï¼š**

åœ¨ä½ çš„åº”ç”¨ä¸­ï¼ˆä¾‹å¦‚ `apps/APP1/src/api.ts`ï¼‰ï¼Œä½ å¯ä»¥è¿™æ ·ä½¿ç”¨å®ƒæ¥æ„å»ºä½ çš„ API æœåŠ¡ï¼š

```typescript
import { createHttpClient, createApi } from "@trs/fetch";
import { useAuthStore } from "@/stores/auth";

// 1. å®šä¹‰å¤„ç†å™¨ï¼Œå°† store çš„ actions ä¸ fetch åŒ…è§£è€¦
const handlers = {
  getToken: () => {
    const authStore = useAuthStore();
    return authStore.token;
  },
  clearToken: () => {
    const authStore = useAuthStore();
    authStore.clearToken();
  },
  // ... å…¶ä»–å¤„ç†å™¨ï¼Œå¦‚ showLoading, showError ç­‰
};

// 2. åˆ›å»º http å®¢æˆ·ç«¯å®ä¾‹
const httpClient = createHttpClient({
  baseUrl: import.meta.env.VITE_API_URL, // ä»ç¯å¢ƒå˜é‡è¯»å– API åœ°å€
  handlers,
});

// 3. ä½¿ç”¨ createApi åˆ›å»ºç»“æ„åŒ–çš„ API æœåŠ¡
const api = createApi(httpClient);

// 4. åœ¨ä¸šåŠ¡ä»£ç ä¸­è°ƒç”¨
// api.auth.login({ username: 'admin', password: 'password' });
// api.user.getList();

export default api;
```

### ä¸€ä¸ªé‡è¦çš„é™·é˜±ï¼š`dependsOn` çš„ç¼ºå¤±

è¿™æ˜¯ä¸€ä¸ªéå¸¸å®¹æ˜“è¢«å¿½ç•¥ä½†è‡³å…³é‡è¦çš„é…ç½®ã€‚ç†è§£å®ƒèƒ½å¸®ä½ é¿å…åœ¨å¢é‡éƒ¨ç½²æ—¶é‡åˆ°å›°æƒ‘ã€‚

**é—®é¢˜åœºæ™¯ï¼š**
å‡è®¾ä½ åªä¿®æ”¹äº† `app1` çš„ä»£ç ï¼Œç„¶åè¿è¡Œå¢é‡éƒ¨ç½²å‘½ä»¤ï¼š
```bash
pnpm deploy:prod --filter="...[HEAD~1]"
```
ä½ æœŸæœ›çš„ç»“æœæ˜¯**åªæœ‰ `app1`** è¢«æ„å»ºå’Œéƒ¨ç½²ã€‚

ä½†æ˜¯ï¼Œå¦‚æœä½ çš„ `turbo.json` ä¸­ `deploy:prod` ä»»åŠ¡æ˜¯è¿™æ ·é…ç½®çš„ï¼ˆç¼ºå°‘ `dependsOn`ï¼‰ï¼š
```json
// turbo.json (é”™è¯¯é…ç½®)
"deploy:prod": {
  "cache": false
}
```
ä½ ä¼šå‘ç°ï¼Œ`app1`ã€`app2` ä»¥åŠ**æ‰€æœ‰**å®šä¹‰äº† `deploy:prod` è„šæœ¬çš„åº”ç”¨éƒ½ä¼šè¢«æ‰§è¡Œã€‚

**åŸå› å‰–æï¼š**
`--filter` ç¡®å®æ­£ç¡®åœ°å‘Šè¯‰äº† `turbo` å˜æ›´çš„â€œèµ·ç‚¹â€åœ¨ `app1`ã€‚ä½†ç”±äº `deploy:prod` ä»»åŠ¡åœ¨ `turbo` çš„â€œä»»åŠ¡åœ°å›¾â€ä¸Šæ˜¯ä¸€ä¸ªå­¤ç«‹çš„ç‚¹ï¼Œ`turbo` ä¸çŸ¥é“è¿™ä¸ªä»»åŠ¡æ˜¯å¦ä¾èµ–äºå…¶ä»–åŒ…ï¼ˆå¦‚ `@trs/ui`ï¼‰çš„æ„å»ºäº§ç‰©ã€‚

å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œ`turbo` ä¼šé‡‡å–æœ€ä¿å®ˆçš„ç­–ç•¥ï¼šå®ƒä¼šè®¤ä¸ºæ‰€æœ‰å®šä¹‰äº† `deploy:prod` è„šæœ¬çš„åŒ…éƒ½å¯èƒ½æ˜¯ç›¸å…³çš„ï¼Œå› æ­¤åœ¨æ‰€æœ‰è¿™äº›åŒ…ä¸­éƒ½æ‰§è¡Œè¯¥ä»»åŠ¡ï¼Œä»¥é˜²æ­¢å› ç¼ºå°‘æ½œåœ¨çš„ã€æœªå£°æ˜çš„ä¾èµ–è€Œå¯¼è‡´éƒ¨ç½²å¤±è´¥ã€‚

**æœ€ç»ˆçš„æ­£ç¡®é…ç½®ï¼š**

ç»è¿‡åå¤è°ƒè¯•ï¼Œæˆ‘ä»¬å‘ç°é™¤äº† `dependsOn`ï¼Œè¿˜æœ‰ä¸€ä¸ªæ›´å…³é”®çš„å› ç´ ï¼š`"cache": false`ã€‚

`"cache": false` çš„ä¼˜å…ˆçº§éå¸¸é«˜ï¼Œå®ƒä¼šå¼ºåˆ¶ `turbo` åœ¨æ‰€æœ‰åŒ¹é…çš„åŒ…ä¸­æ— æ¡ä»¶æ‰§è¡Œè¯¥ä»»åŠ¡ï¼Œè¿™ä½¿å¾— `--filter` çš„ç­›é€‰èƒ½åŠ›å¤±æ•ˆã€‚

å› æ­¤ï¼Œæœ€ç»ˆçš„ã€èƒ½è®©å¢é‡éƒ¨ç½²å®Œç¾å·¥ä½œçš„é…ç½®æ˜¯ï¼š
```json
// turbo.json (æœ€ç»ˆæ­£ç¡®é…ç½®)
"deploy:prod": {
  "dependsOn": ["build:prod"]
}
```
**ä¸è¦**æ·»åŠ  `"cache": false`ã€‚

è¿™æ ·ï¼Œ`turbo` æ‰èƒ½å®Œå…¨åˆ©ç”¨å®ƒçš„ä¾èµ–å›¾å’Œç¼“å­˜ç³»ç»Ÿï¼šå½“å®ƒå‘ç° `app2` çš„ `build:prod` ä»»åŠ¡å‘½ä¸­ç¼“å­˜ï¼ˆ`CACHE HIT`ï¼‰æ—¶ï¼Œå®ƒä¼šé¡ºç†æˆç« åœ°å°†ä¾èµ–äºæ­¤çš„ `app2` çš„ `deploy:prod` ä»»åŠ¡ä¹Ÿæ ‡è®°ä¸ºç¼“å­˜å‘½ä¸­ï¼Œä»è€Œ**çœŸæ­£åœ°è·³è¿‡**è¯¥ä»»åŠ¡çš„æ‰§è¡Œã€‚

##  å¿«é€Ÿå¼€å§‹

> **âš ï¸ é‡è¦åŸåˆ™ï¼šå§‹ç»ˆåœ¨æ ¹ç›®å½•æ‰§è¡Œå‘½ä»¤**
>
> åœ¨è¿™ä¸ª Monorepo é¡¹ç›®ä¸­ï¼Œæ‰€æœ‰çš„ `pnpm` å’Œ `turbo` å‘½ä»¤ï¼ˆå¦‚å®‰è£…ä¾èµ–ã€å¯åŠ¨æœåŠ¡ã€æ„å»ºã€éƒ¨ç½²ç­‰ï¼‰éƒ½åº”è¯¥åœ¨**é¡¹ç›®æ ¹ç›®å½•**ä¸‹æ‰§è¡Œã€‚è¿™æ˜¯ç¡®ä¿ pnpm å·¥ä½œç©ºé—´å’Œ Turborepo ä»»åŠ¡è°ƒåº¦æ­£å¸¸å·¥ä½œçš„å…³é”®ã€‚è¯·ä¸è¦ `cd` åˆ°å­ç›®å½•ï¼ˆå¦‚ `apps/app1`ï¼‰ä¸­å»æ‰§è¡Œè¿™äº›å‘½ä»¤ã€‚

**1. å…‹éš†é¡¹ç›®**

```bash
git clone <your-repo-url>
cd <your-repo-name>
```

**2. å®‰è£…ä¾èµ–**

åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œï¼š

```bash
pnpm install
```

**3. åˆå§‹åŒ– Git Hooks**

ä¸ºäº†ç¡®ä¿ä»£ç æäº¤æ—¶è‡ªåŠ¨æ‰§è¡Œä»£ç é£æ ¼æ£€æŸ¥ï¼Œä½ éœ€è¦åˆå§‹åŒ– `simple-git-hooks`ã€‚è¿™åªéœ€è¦åœ¨ç¬¬ä¸€æ¬¡è®¾ç½®é¡¹ç›®æ—¶æ‰§è¡Œä¸€æ¬¡ã€‚

```bash
pnpm sgh
```

**4. å¯åŠ¨å¼€å‘æœåŠ¡**

æ­¤å‘½ä»¤ä¼šåŒæ—¶å¯åŠ¨æ‰€æœ‰ `apps` ä¸‹çš„åº”ç”¨ï¼š

```bash
pnpm dev
```

ç„¶åä½ å°±å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è®¿é—®å¯¹åº”çš„åº”ç”¨äº†ï¼ˆé€šå¸¸æ˜¯ `http://localhost:5173` å’Œ `http://localhost:5174`ï¼‰ã€‚

## ğŸ› ï¸ å¸¸ç”¨å‘½ä»¤

æ‰€æœ‰å‘½ä»¤éƒ½å»ºè®®åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œã€‚

- `pnpm dev`: å¯åŠ¨æ‰€æœ‰åº”ç”¨çš„å¼€å‘æ¨¡å¼ã€‚
- `pnpm build`: æ£€æŸ¥**æ‰€æœ‰**åº”ç”¨å’ŒåŒ…ï¼Œå¹¶åˆ©ç”¨ç¼“å­˜ï¼Œåªé‡æ–°æ„å»ºé‚£äº›å‘ç”Ÿå˜åŒ–çš„éƒ¨åˆ†ã€‚
- `pnpm lint`: å¯¹æ•´ä¸ªé¡¹ç›®è¿›è¡Œä»£ç é£æ ¼æ£€æŸ¥å¹¶è‡ªåŠ¨ä¿®å¤ã€‚

> **`build` å’Œ `deploy` çš„è¡Œä¸ºåŒºåˆ«**
>
> - **`pnpm build` (ä¸å¸¦ filter)**: `turbo` ä¼šæ£€æŸ¥**æ‰€æœ‰**åŒ…ã€‚å¯¹äºæœªå˜æ›´çš„ `app2`ï¼Œå…¶ `build` ä»»åŠ¡ä¼šå‘½ä¸­ç¼“å­˜ (`CACHE HIT`)ï¼Œ`turbo` ä¼šè·³è¿‡æ„å»ºï¼Œè¿™ä¸ªè¡Œä¸ºæ˜¯ç¬¦åˆç›´è§‰çš„ã€‚
> - **`pnpm deploy:prod` (ä¸å¸¦ filter)**: `turbo` åŒæ ·ä¼šæ£€æŸ¥**æ‰€æœ‰**åŒ…ã€‚ä½† `deploy` æ˜¯ä¸€ä¸ªæœ‰â€œå‰¯ä½œç”¨â€çš„åŠ¨ä½œï¼ˆæ¯”å¦‚è°ƒç”¨å¤–éƒ¨ APIï¼‰ã€‚`turbo` çš„ç¼“å­˜ç³»ç»Ÿä¸»è¦æ˜¯ä¸ºäº†å¯å¤ç°çš„æ„å»ºï¼ˆ`build`ï¼‰ï¼Œè€Œä¸æ˜¯ä¸ºäº†æœ‰å‰¯ä½œç”¨çš„æ“ä½œã€‚å› æ­¤ï¼Œå³ä½¿ `app2` çš„ `build` å‘½ä¸­äº†ç¼“å­˜ï¼Œ`turbo` ä»ç„¶å¯èƒ½ä¼šæ‰§è¡Œ `app2` çš„ `deploy` è„šæœ¬ï¼Œå› ä¸ºå®ƒæ— æ³•ç¼“å­˜â€œéƒ¨ç½²â€è¿™ä¸ªåŠ¨ä½œæœ¬èº«ã€‚
>
> **ç»“è®º**ï¼šå¯¹äº `build` è¿™ç§å¯ç¼“å­˜çš„ä»»åŠ¡ï¼Œå¯ä»¥ä¸å¸¦ `--filter`ã€‚ä½†å¯¹äº `deploy` è¿™ç§åŒ…å«å‰¯ä½œç”¨ã€éœ€è¦ç²¾ç¡®æ§åˆ¶æ‰§è¡ŒèŒƒå›´çš„ä»»åŠ¡é“¾ï¼Œ**å¿…é¡»ä½¿ç”¨ `--filter`** æ¥ä»æºå¤´ä¸Šå‘Šè¯‰ `turbo`ï¼šâ€œä»Šå¤©åªè€ƒè™‘è¿™å‡ ä¸ªåŒ…ï¼Œå…¶ä»–çš„å®Œå…¨ä¸ç”¨çœ‹â€ï¼Œè¿™æ ·æ‰èƒ½å®ç°ç²¾ç¡®çš„å¢é‡éƒ¨ç½²ã€‚

### ä¸ºç‰¹å®šåº”ç”¨/åŒ…å®‰è£…ä¾èµ–

åœ¨ Monorepo ä¸­ï¼Œä½ ä¸åº”è¯¥ `cd`åˆ°å­é¡¹ç›®ç›®å½•å»å®‰è£…ä¾èµ–ã€‚æ­£ç¡®çš„åšæ³•æ˜¯**å§‹ç»ˆåœ¨æ ¹ç›®å½•**ï¼Œä½¿ç”¨ `pnpm` çš„ `--filter` æ ‡å¿—æ¥æŒ‡å®šç›®æ ‡ã€‚

**è¯­æ³•ï¼š** `pnpm add <package-name> --filter <app-or-package-name>`

**ç¤ºä¾‹ï¼š**
- **ä¸º `app1` æ·»åŠ ä¸€ä¸ªæ–°çš„ç”Ÿäº§ä¾èµ– `axios`**:
  ```bash
  pnpm add axios --filter app1
  ```
- **ä¸º `@trs/ui` åŒ…æ·»åŠ ä¸€ä¸ªæ–°çš„å¼€å‘ä¾èµ– `less`**:
  ```bash
  pnpm add less -D --filter @trs/ui
  ```
`pnpm` ä¼šè‡ªåŠ¨æ‰¾åˆ°å¯¹åº”çš„ `package.json` å¹¶æ›´æ–°å®ƒã€‚

### æ–°å¢é¡¹ç›®

å½“ä½ åœ¨ `apps` ç›®å½•ä¸‹æ·»åŠ ä¸€ä¸ªæ–°çš„å­é¡¹ç›®æ—¶ï¼ˆä¾‹å¦‚ `APP3`ï¼‰ï¼Œè¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ä»¥ç¡®ä¿å…¶æ­£ç¡®é›†æˆåˆ° Turborepo å·¥ä½œæµä¸­ï¼š

**1. é…ç½® `vite.config.js`**

ä¸ºäº†è®©æ–°çš„å­é¡¹ç›®èƒ½å¤Ÿæ­£ç¡®åŠ è½½æ ¹ç›®å½•ä¸‹çš„ `.env` æ–‡ä»¶ï¼Œä½ éœ€è¦åœ¨å…¶ `vite.config.js` ä¸­è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š

```javascript
import { defineConfig } from 'vite';
import vue from '@vitejs/plugin-vue';
import path from 'path';

export default defineConfig({
  plugins: [vue()],
  // å…³é”®é…ç½®ï¼šå°† envDir æŒ‡å‘æ ¹ç›®å½•
  envDir: path.resolve(__dirname, '../../'),
});
```

**2. é…ç½® `package.json`**

åœ¨æ–°é¡¹ç›®çš„ `package.json` ä¸­ï¼Œä½ éœ€è¦è®¾ç½®ä»¥ä¸‹å…³é”®å­—æ®µï¼š

- **`scripts`**: æ·»åŠ æ„å»ºã€éƒ¨ç½²å’Œä»£ç æ£€æŸ¥è„šæœ¬ã€‚`APP_NAME` éœ€è¦æ›¿æ¢ä¸ºä½ çš„åº”ç”¨åï¼ˆä¾‹å¦‚ `APP3`ï¼‰ã€‚
- **`dependencies`**: æ·»åŠ å¯¹å…±äº«åŒ…ï¼ˆå¦‚ `@trs/ui`ï¼‰çš„å¼•ç”¨ã€‚
- **`devDependencies`**: æ·»åŠ  `eslint` ä»¥æ”¯æŒä»£ç æ£€æŸ¥ã€‚

```json
{
  "name": "your-app-name",
  "version": "1.0.0",
  "private": true,
  "scripts": {
    "dev": "vite",
    "build:dev": "vite build --mode development",
    "build:prod": "vite build",
    "preview": "vite preview",
    "deploy:dev": "bash ../../scripts/deploy.sh APP_NAME dev",
    "deploy:prod": "bash ../../scripts/deploy.sh APP_NAME prod",
    "lint": "eslint ."
  },
  "dependencies": {
    "vue": "^3.5.18",
    "@trs/ui": "workspace:*",
    "@trs/config": "workspace:*",
    "@trs/utils": "workspace:*",
    "@trs/lint": "workspace:*"
  },
  "devDependencies": {
    "eslint": "latest",
    "vite": "latest",
    "@vitejs/plugin-vue": "latest"
  }
}
```

**3. æŒ‰éœ€æ·»åŠ ä¾èµ–**

æ ¹æ®ä½ çš„é¡¹ç›®éœ€æ±‚ï¼Œå¯èƒ½éœ€è¦æ·»åŠ å…¶ä»–å…±äº«åŒ…ä½œä¸ºä¾èµ–ï¼Œä¾‹å¦‚ï¼š

- `@trs/fetch`: å¦‚æœéœ€è¦ä½¿ç”¨å…±äº«çš„æ•°æ®è¯·æ±‚æ¨¡å—ã€‚

åªéœ€åœ¨ `dependencies` ä¸­æ·»åŠ  `"@trs/fetch": "workspace:*"` å³å¯ã€‚

å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œè®°å¾—åœ¨æ ¹ç›®å½•é‡æ–°æ‰§è¡Œ `pnpm install`ï¼Œä»¥ç¡®ä¿æ‰€æœ‰ä¾èµ–å…³ç³»éƒ½å·²æ­£ç¡®é“¾æ¥ã€‚



eslint æ”¾å¼ƒå…¨å±€å•ä¸€eslint.config.mjs
è€Œæ˜¯å°è£…ä¸ºä¸€ä¸ªä¾èµ–åŒ… è§„å®šé€šç”¨çš„eslinté…ç½® ä¸åŒé¡¹ç›®å¯ä»¥æ ¹æ®éœ€è¦å¾®è°ƒ,å¦‚æ·»åŠ æ–°ruleæˆ–è€…è¦†ç›–åŸæŸæ¡rule

ä½¿ç”¨æ³¨æ„:éœ€è¦é¡¹ç›®è‡ªèº«å®‰è£…`eslint`ä¾èµ–ä»¥åŠé…ç½®lintè„šæœ¬,å¹¶ä¸”ç‰ˆæœ¬æ¨èå’Œ`@trs/lint`ä¾èµ–ç‰ˆæœ¬ä¸€è‡´

```json

pnpm i -D eslint

"scripts": {
  "lint": "eslint"
}
```


## é«˜çº§ç”¨æ³•ï¼šå¢é‡æ‰§è¡Œ

Turborepo æœ€å¼ºå¤§çš„åŠŸèƒ½ä¹‹ä¸€å°±æ˜¯èƒ½å¤Ÿåªåœ¨â€œå—å½±å“â€çš„å·¥ä½œç©ºé—´ä¸Šæ‰§è¡Œä»»åŠ¡ã€‚è¿™é€šå¸¸é€šè¿‡ `--filter` æ ‡å¿—å’Œ Git å†å²è®°å½•æ¥å®ç°ã€‚

### åœºæ™¯ä¸€ï¼šå¢é‡æ„å»ºä¸éƒ¨ç½²

**ç›®æ ‡**ï¼šå½“æˆ‘ä»¬åªä¿®æ”¹äº† `app1` æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›åªæ„å»ºå’Œéƒ¨ç½² `app1`ï¼Œè€Œå®Œå…¨è·³è¿‡ `app2`ã€‚

**æœ€ç»ˆçš„æ­£ç¡®å·¥ä½œæµ**ï¼š

1.  **ç¡®ä¿ `turbo.json` é…ç½®æ­£ç¡®**ï¼š
    *   ä»»åŠ¡ä¹‹é—´å¿…é¡»æœ‰æ˜ç¡®çš„ `dependsOn` ä¾èµ–å…³ç³»ã€‚
    *   **ä¸è¦**ä¸ºéœ€è¦å¢é‡æ‰§è¡Œçš„ä»»åŠ¡ï¼ˆå¦‚ `deploy`ï¼‰è®¾ç½® `"cache": false`ã€‚
    ```json
    // turbo.json (æ­£ç¡®é…ç½®)
    "deploy:prod": {
      "dependsOn": ["build:prod"]
    }
    ```

2.  **ç¡®ä¿ Git å·¥ä½œåŒºå¹²å‡€**ï¼š
    åœ¨æ‰§è¡Œå¢é‡å‘½ä»¤å‰ï¼Œè¯·ç¡®ä¿æ²¡æœ‰æœªæäº¤çš„ã€å¯èƒ½å½±å“æ‰€æœ‰åŒ…çš„å…¨å±€æ–‡ä»¶å˜æ›´ï¼ˆä¾‹å¦‚å¯¹æ ¹ `package.json` æˆ– `pnpm-lock.yaml` çš„ä¿®æ”¹ï¼‰ã€‚ä¸€ä¸ªâ€œè„â€çš„ `package.json` ä¼šè®© `turbo` è®¤ä¸ºæ‰€æœ‰åŒ…éƒ½å—åˆ°äº†å½±å“ã€‚

3.  **åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨è¿‡æ»¤å™¨**ï¼š
    *   **éƒ¨ç½²ç‰¹æ€§åˆ†æ”¯çš„å…¨éƒ¨å˜æ›´ (æœ€æ¨è)**:
        åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸åœ¨ç‰¹æ€§åˆ†æ”¯ï¼ˆfeature branchï¼‰ä¸Šè¿›è¡Œå¤šæ¬¡æäº¤ã€‚å½“éœ€è¦éƒ¨ç½²æ•´ä¸ªç‰¹æ€§åˆ†æ”¯çš„å˜æ›´æ—¶ï¼Œæœ€ä½³å®è·µæ˜¯å°†å…¶ä¸ä¸»å¹²åˆ†æ”¯ï¼ˆå¦‚ `main`ï¼‰è¿›è¡Œæ¯”è¾ƒã€‚
        ```bash
        # ç¡®ä¿ä½ çš„ main åˆ†æ”¯æ˜¯è¿œç¨‹æœ€æ–°çš„
        git fetch origin main
        
        # éƒ¨ç½²å½“å‰åˆ†æ”¯ç›¸è¾ƒäº main åˆ†æ”¯çš„æ‰€æœ‰å˜æ›´
        pnpm deploy:prod --filter="...[origin/main]"
        ```
        è¿™ä¸ªå‘½ä»¤èƒ½å‡†ç¡®åœ°åŒ…å«ä½ åœ¨ç‰¹æ€§åˆ†æ”¯ä¸Šçš„æ‰€æœ‰æäº¤ï¼Œæ— è®ºæ˜¯ä¸€ä¸ªè¿˜æ˜¯å¤šä¸ªã€‚

### åœºæ™¯äºŒï¼šCI/CD ä¸­çš„è‡ªåŠ¨åŒ–ç»Ÿä¸€å¢é‡éƒ¨ç½²

åœ¨æ‹¥æœ‰å¤šä¸ªç›®æ ‡ç¯å¢ƒï¼ˆå¦‚ `dev` ç¯å¢ƒå¯¹åº” `dev` åˆ†æ”¯ï¼Œ`prod` ç¯å¢ƒå¯¹åº” `main` åˆ†æ”¯ï¼‰çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›æœ‰ä¸€ä¸ªç»Ÿä¸€çš„å‘½ä»¤é€»è¾‘æ¥å¤„ç†å¢é‡éƒ¨ç½²ã€‚

è¿™å¯ä»¥é€šè¿‡ç»“åˆ CI/CD å¹³å°çš„ç¯å¢ƒå˜é‡æ¥å®ç°ã€‚`git` å‘½ä»¤æœ¬èº«æ— æ³•è‡ªåŠ¨æ¨æ–­ç›®æ ‡åˆ†æ”¯ï¼Œä½† CI/CD å¹³å°å¯ä»¥å‘Šè¯‰æˆ‘ä»¬ã€‚

**å·¥ä½œæµï¼š**

1.  åœ¨ CI/CD å¹³å°ï¼ˆå¦‚ GitHub Actionsï¼‰ä¸­ï¼Œé…ç½®ä¸€ä¸ªå·¥ä½œæµï¼Œè®©å®ƒåœ¨ä»£ç æ¨é€åˆ° `main` å’Œ `dev` åˆ†æ”¯æ—¶è§¦å‘ã€‚
2.  åœ¨å·¥ä½œæµçš„æ‰§è¡Œè„šæœ¬ä¸­ï¼Œä½¿ç”¨å¹³å°æä¾›çš„å†…ç½®å˜é‡ï¼ˆå¦‚ `github.ref_name`ï¼‰æ¥åŠ¨æ€æ„å»º `filter` å‚æ•°ã€‚

**GitHub Actions ç¤ºä¾‹ (`.github/workflows/deploy.yml`)**
```yaml
# .github/workflows/deploy.yml
name: Deploy to Environments

on:
  push:
    branches:
      - main
      - dev

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      # ... çœç•¥ checkout, setup pnpm, install ç­‰æ­¥éª¤ ...

      - name: Deploy changed apps
        run: |
          # ${{ github.ref_name }} ä¼šè¢« GitHub Actions è‡ªåŠ¨æ›¿æ¢ä¸º
          # è§¦å‘æµæ°´çº¿çš„çš„åˆ†æ”¯åï¼Œå³ 'main' æˆ– 'dev'ã€‚
          # è¿™æ ·å°±å®ç°äº†ç”¨ä¸€ä¸ªå‘½ä»¤ï¼Œè‡ªåŠ¨ä¸æ­£ç¡®çš„ç›®æ ‡åˆ†æ”¯è¿›è¡Œæ¯”è¾ƒã€‚
          pnpm deploy:prod --filter="...[origin/${{ github.ref_name }}]"
```

é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ‚¨æ— éœ€åœ¨æœ¬åœ°æˆ– CI/CD ä¸­ç»´æŠ¤å¤šä¸ªä¸åŒçš„éƒ¨ç½²å‘½ä»¤ï¼Œå®ç°äº†çœŸæ­£çš„è‡ªåŠ¨åŒ–å’Œç»Ÿä¸€åŒ–ã€‚

éµå¾ªä»¥ä¸Šæ­¥éª¤ï¼Œ`turbo` å°±èƒ½å¤Ÿç²¾ç¡®åœ°è¯†åˆ«å‡ºåªæœ‰ `app1` å‘ç”Ÿäº†å˜åŒ–ï¼Œå¹¶æ™ºèƒ½åœ°è·³è¿‡æ‰€æœ‰ä¸ `app2` ç›¸å…³çš„ä»»åŠ¡ã€‚

### åœºæ™¯äºŒï¼šæœ¬åœ°æäº¤æ—¶çš„å¢é‡æ£€æŸ¥ (ä¾‹å¦‚ `lint`)

åœ¨æœ¬åœ°å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨ `git commit` æ—¶ä»…å¯¹æœ¬æ¬¡æäº¤ä¸­æš‚å­˜ï¼ˆstagedï¼‰çš„æ–‡ä»¶è¿›è¡Œä»£ç æ£€æŸ¥ã€‚è¿™ä¸ªè¿‡ç¨‹ç”± `simple-git-hooks` å’Œ `lint-staged` ååŒå®Œæˆã€‚

**å‰ææ¡ä»¶**ï¼šä¸ºäº†ä½¿è¯¥åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼Œè¯·ç¡®ä¿æ ¹ç›®å½•çš„ `package.json` ä¸­å·²å®‰è£… `lint-staged` å’Œ `simple-git-hooks` ä½œä¸ºå¼€å‘ä¾èµ–ã€‚å¦‚æœç¼ºå¤±ï¼Œè¯·æ‰§è¡Œ `pnpm add -D -w lint-staged simple-git-hooks` è¿›è¡Œå®‰è£…ã€‚

**å·¥ä½œåŸç†**ï¼š

1.  **`simple-git-hooks` è§¦å‘**: å½“æ‚¨æ‰§è¡Œ `git commit` æ—¶ï¼Œ`simple-git-hooks` ä¼šæ ¹æ®é…ç½®ï¼ˆ`"pre-commit": "pnpm staged"`ï¼‰æ‰§è¡Œ `pnpm staged` å‘½ä»¤ã€‚
2.  **`lint-staged` æ•è·æ–‡ä»¶**: `lint-staged` å¯åŠ¨åï¼Œä¼šè·å–æ‰€æœ‰æš‚å­˜åŒºå†…çš„æ–‡ä»¶ã€‚
3.  **`lint-staged` è°ƒç”¨ `turbo`**: å®ƒå°†åŒ¹é…åˆ°çš„**å…·ä½“æ–‡ä»¶å**ä½œä¸ºå‚æ•°ï¼Œä¼ é€’ç»™ `turbo` å‘½ä»¤ã€‚
4.  **`turbo` åˆ†å‘ä»»åŠ¡**: `turbo` æ¥æ”¶åˆ°å‘½ä»¤åï¼Œä¼šæ™ºèƒ½åœ°åˆ†ææ¯ä¸ªæ–‡ä»¶å±äºå“ªä¸ªå·¥ä½œç©ºé—´ã€‚
5.  **`eslint` ç²¾å‡†æ‰§è¡Œ**: `turbo` ä¼šåœ¨å¯¹åº”çš„å·¥ä½œç©ºé—´å†…æ‰§è¡Œ `lint` è„šæœ¬ï¼ˆä¾‹å¦‚ `"lint": "eslint"`ï¼‰ï¼Œå¹¶å°†æ–‡ä»¶å’Œä»é¡¶å±‚ä¼ æ¥çš„ `--fix` å‚æ•°ä¸€å¹¶äº¤ç»™ `eslint`ã€‚


**é‡è¦é…ç½®ï¼š`lint-staged`ã€`turbo` ä¸ `eslint` çš„ååŒ**

ä¸ºäº†è®© `lint-staged` åœ¨æäº¤æ—¶æ­£ç¡®åœ°å¯¹æš‚å­˜æ–‡ä»¶è¿›è¡Œæ£€æŸ¥ï¼Œéœ€è¦ç¡®ä¿æ ¹ç›®å½•å’Œå­é¡¹ç›®çš„ `package.json` é…ç½®æ­£ç¡®ååŒã€‚

1.  **å­é¡¹ç›®é…ç½® (`apps/APP1/package.json`)**
    å­é¡¹ç›®çš„ `lint` è„šæœ¬åº”è¯¥éå¸¸çº¯ç²¹ï¼Œåªä¿ç•™ `eslint` å‘½ä»¤æœ¬èº«ï¼Œä»¥ä¾¿æ¥æ”¶æ¥è‡ª `lint-staged` ä¼ é€’çš„æ–‡ä»¶åˆ—è¡¨ã€‚
    ```json
    "scripts": {
      "lint": "eslint"
    }
    ```

2.  **æ ¹é¡¹ç›®é…ç½® (`package.json`)**
    æ ¹ç›®å½•çš„ `lint-staged` é…ç½®è´Ÿè´£è°ƒç”¨ `turbo`ï¼Œå¹¶ä½¿ç”¨ `--` åˆ†éš”ç¬¦å°† `lint-staged` æ•è·çš„æ–‡ä»¶åˆ—è¡¨ä½œä¸ºå‚æ•°ä¼ é€’ä¸‹å»ã€‚
    ```json
    "lint-staged": {
      "*.{js,jsx,ts,tsx,vue}": "turbo run lint --"
    }
    ```

åŒæ—¶ï¼Œä¸ºäº†å®ç°è‡ªåŠ¨ä¿®å¤ï¼Œæ ¹ç›®å½•çš„ `lint` è„šæœ¬åº”é…ç½®ä¸ºï¼š
```json
"scripts": {
  "lint": "turbo run lint -- --fix"
}
```
è¿™é‡Œçš„ç¬¬ä¸€ä¸ª `--` æ˜¯ `turbo` ç”¨æ¥å°† `--fix` å‚æ•°ä¼ é€’ç»™å­é¡¹ç›®çš„ `lint` è„šæœ¬ã€‚

**ç»“è®º**ï¼š
- å¯¹äº `deploy` è¿™ç±»ç”±å¼€å‘è€…æˆ– CI ä¸»åŠ¨å‘èµ·çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬ä½¿ç”¨ `--filter` æ¥**å‘ŠçŸ¥ `turbo` å˜æ›´çš„èŒƒå›´**ï¼ˆä¾‹å¦‚ `...[HEAD~1]`ï¼‰ã€‚
- å¯¹äº `lint` è¿™ç±»ç”± `lint-staged` è§¦å‘çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬ä¾èµ– `lint-staged` **æ”¶é›†æ–‡ä»¶åˆ—è¡¨**ï¼Œå¹¶é€šè¿‡ `turbo run lint --` çš„æ–¹å¼ï¼Œå°†è¿™äº›æ–‡ä»¶ä½œä¸º**å‚æ•°**ä¼ é€’ç»™å¯¹åº”å·¥ä½œç©ºé—´å†…çš„ `eslint` è¿›ç¨‹ã€‚
